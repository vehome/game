require=function t(e,a,n){function r(c,s){if(!a[c]){if(!e[c]){var o="function"==typeof require&&require;if(!s&&o)return o(c,!0);if(i)return i(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var h=a[c]={exports:{}};e[c][0].call(h.exports,function(t){var a=e[c][1][t];return r(a?a:t)},h,h.exports,t,e,a,n)}return a[c].exports}for(var i="function"==typeof require&&require,c=0;c<n.length;c++)r(n[c]);return r}({AudioManager:[function(t,e,a){"use strict";cc._RFpush(e,"7aa46Eve7hKs5CG4gBWR6PV","AudioManager"),cc.Class({"extends":cc.Component,properties:{isOpen:!0,soundValue:1,lunch:{url:cc.AudioClip,"default":null},enter:{url:cc.AudioClip,"default":null},swardattack:{url:cc.AudioClip,"default":null}},onLoad:function(){this.isOpen=!0},playBGM:function(){this.currentBGM=cc.audioEngine.play(this.lunch,!1,this.soundValue)},stopBGM:function(){cc.audioEngine.stop(this.currentBGM)},stopAll:function(){this.currentBGM=cc.audioEngine.stopAll()},playEFT:function(t){var e,a=this;switch(t){case 1:e=a.enter;break;case 2:e=a.swardattack}cc.audioEngine.play(e,!1,this.soundValue)},checkMusic:function(){return this.isOpen},update:function(){}}),cc._RFpop()},{}],Camera:[function(t,e,a){"use strict";cc._RFpush(e,"bd77dJXrJdBi5IM4B63ncj0","Camera"),cc.Class({"extends":cc.Component,properties:{target:{"default":null,type:cc.Node},map:{"default":null,type:cc.Node}},init:function(t){var e=cc.winSize;this.screenMiddle=cc.v2(e.width/2,e.height/2),this.boundingBox=cc.rect(0,0,this.map.width,this.map.height),t?(this.target=t,this.type=1,this.minx=-(this.boundingBox.xMax-e.width),this.maxx=this.boundingBox.xMin,this.miny=-(this.boundingBox.yMax-e.height),this.maxy=this.boundingBox.yMin):(this.target=null,this.type=2,this.minx=e.width/2-this.boundingBox.xMax,this.maxx=this.boundingBox.xMin-e.width/2,this.miny=e.height/2-this.boundingBox.yMax,this.maxy=this.boundingBox.yMin-e.height/2)},onLoad:function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){var a=e.getDeltaX(),n=e.getDeltaY();t.node.x<t.minx-40||t.node.x>t.maxx+40||t.node.y>t.maxy+40||t.node.y<t.miny-40||t.node.runAction(cc.moveBy(0,a,n))}),this.node.on(cc.Node.EventType.TOUCH_START,function(e){t.map.touched=!0}),this.node.on(cc.Node.EventType.TOUCH_END,function(e){t.map.touched=!1}),this.node.on("mousewheel",function(e){var a,n=e.getScrollY();a=n>0?cc.scaleBy(.5,1.1):cc.scaleBy(.5,.9),t.node.runAction(a)})},update:function(t){if(2==this.type){if(!this.map.touched){var e=cc.clampf(this.map.x,this.minx,this.maxx),a=cc.clampf(this.map.y,this.miny,this.maxy);this.map.setPosition(e,a)}}else if(1==this.type){var n,r=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO);n=this.target?this.target.convertToWorldSpaceAR(cc.Vec2.ZERO):cc.Vec2.ZERO;var i=r.sub(n),c=i.add(this.screenMiddle);c.x=cc.clampf(c.x,this.minx,this.maxx),c.y=cc.clampf(c.y,this.miny,this.maxy),this.node.position=this.node.parent.convertToNodeSpaceAR(c)}}}),cc._RFpop()},{}],PlayerManager:[function(t,e,a){"use strict";cc._RFpush(e,"bea15PkCuNDkbSRvNTBpCf1","PlayerManager"),cc.Class({"extends":cc.Component,properties:{player:{"default":null,type:cc.Prefab},actionList:{"default":null,type:cc.Prefab}},onLoad:function(){},setListener:function(t,e){this.getDisBynode(t).addEventListener(dragonBones.EventObject.FRAME_EVENT,e,this)},createrPlayer:function(t,e,a){this.context=t;var n=cc.instantiate(this.player);return n.setPosition(e?e:0,a?a:0),t.node.addChild(n,t.node.getContentSize().height-n.y),this.setListener(n,function(t){cc.log(t)}),n.actionOver=!1,n},setSuit:function(t,e,a,n,r,i,c,s,o,l,h,d,u,p){this.setChildSlot(t,"hairdo",e),this.setChildSlot(t,"head",a),this.setChildSlot(t,"body",n),this.setChildSlot(t,"arma",r),this.setChildSlot(t,"armb",i),this.setChildSlot(t,"armc",c),this.setChildSlot(t,"armd",s),this.setChildSlot(t,"lega",o),this.setChildSlot(t,"legb",l),this.setChildSlot(t,"legc",h),this.setChildSlot(t,"legd",d),this.setChildSlot(t,"sward",u),this.setChildSlot(t,"pad",p)},setTeam:function(t,e){t.team=e,this.setColor(t,e),this.context.playerList[e-1]||(this.context.playerList[e-1]=[]),this.context.playerList[e-1].push(t)},setColor:function(t,e){var a=cc.color(255,255,255);switch(e){case 1:a=cc.color(255,255,255);break;case 2:a=cc.color(0,223,43);break;case 3:a=cc.color(210,230,16)}var n=this.getDisBynode(t).armature();n.getSlot("body").childArmature.display.setColor(a)},setChildSlot:function(t,e,a){var n=this.getDisBynode(t),r=n.armature(),i=n.buildArmature(a);r.getSlot(e).childArmature=i},getDisBynode:function(t){return t.getChildByName("play_ske").getComponent(dragonBones.ArmatureDisplay)},startAnimation:function(t,e){var a=this,n=t.getChildByName("play_ske"),r=n.getComponent(dragonBones.ArmatureDisplay);r.armature().animation.play(e),e.indexOf("sward")!=-1&&setTimeout(function(){a.context.bgm.playEFT(2)},700)},startFadeIn:function(t,e){var a=t.getChildByName("play_ske"),n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn(e,-1,-1,0,"normal")},setActionBox:function(t){var e=this,a=cc.instantiate(this.actionList);this.action=a,a.setPosition(t.x+36,t.y+16),e.context.node.addChild(a,1e4);var n=a.getChildByName("con");n.getChildByName("a1").on("mousedown",this.context.actionListListener),n.getChildByName("a2").on("mousedown",this.context.actionListListener)},cancleActionBox:function(){this.action.destroy()},canclePlayerSeleced:function(){this.context.currentPlayer.selected=!1,this.context.currentPlayer.getComponent(cc.Animation).stop(),this.context.currentPlayer.getChildByName("selected").getComponent(cc.Sprite).spriteFrame=null,this.context.currentPlayer=null,this.context.state=0,this.cancleActionBox(),this.context.Camera.init()}}),cc._RFpop()},{}],SceneManager:[function(t,e,a){"use strict";cc._RFpush(e,"074ccuqeglOqoXIMoDCWGkS","SceneManager"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){cc.game.addPersistRootNode(this.node)},loadScene:function(t){this.curLoadingScene=t,cc.director.preloadScene(t,this.onSceneLoaded)},onSceneLoaded:function(){cc.director.loadScene(this.curLoadingScene)}}),cc._RFpop()},{}],game2:[function(t,e,a){"use strict";cc._RFpush(e,"a81f0D/jmhDfoMX2BHgeXgD","game2");var n=t("PlayerManager"),r=t("Camera"),i=t("AudioManager"),c=null,s={currentTurnNum:0,state:0,currentTeam:1,teamCount:2},o=new StateMachine({data:{},transitions:[{name:"startMyturn",from:"none",to:"mine"}],methods:{onMine:function(){cc.log("my turn"),s.state=0,s.teamTurn=1,s.currentStep++},onEnterState:function(t){cc.log("Turn State: "+t.to+"当前回合数："+s.currentStep+"。当前队伍："+s.teamTurn)}}}),l=new StateMachine({data:{},transitions:[{name:"firstSelect",from:"none",to:"selected"},{name:"cancleSelect",from:"selected",to:"none"},{name:"canclePlayer",from:"drawattack",to:"none"},{name:"drawWalk",from:"selected",to:"drawwalk"},{name:"drawAttack1",from:"selected",to:"drawattack"},{name:"drawAttack2",from:"walkend",to:"drawattack"},{name:"cancleDrawWalk",from:"drawwalk",to:"selected"},{name:"cancleWalkEnd",from:"walkend",to:"drawwalk"},{name:"cancleDrawAttack1",from:"drawattack",to:"selected"},{name:"cancleDrawAttack2",from:"drawattack",to:"walkend"},{name:"walk",from:"drawwalk",to:"walkend"}],methods:{onSelected:function(t){"none"==t.from?(cc.log("player selected"),s.state=1,c.currentPlayer.selected=!0,c.currentPlayer.getComponent(cc.Animation).play("selected"),c.playerManager.setActionBox(c.currentPlayer),c.Camera.init(c.currentPlayer)):"drawwalk"==t.from?(c.dedraw(),s.state=1,c.playerManager.setActionBox(c.currentPlayer)):"drawattack"==t.from&&(c.dedrawAttack(),c.playerManager.setActionBox(c.currentPlayer),s.state=1)},onNone:function(t){"selected"==t.from?(c.currentPlayer.selected=!1,c.currentPlayer.getComponent(cc.Animation).stop(),c.currentPlayer.getChildByName("selected").getComponent(cc.Sprite).spriteFrame=null,c.currentPlayer=null,s.state=0,c.playerManager.cancleActionBox(),c.Camera.init()):"drawattack"==t.from},onDrawwalk:function(t){"selected"==t.from?(c.setMoveList(c.currentTile.x,c.currentTile.y),s.state=2,c.playerManager.cancleActionBox()):"walkend"==t.from&&(c.currentPlayer.setPosition(c.originXY),c.playerZindexSet(),c.draw(),s.state=2,c.playerManager.cancleActionBox())},onDrawattack:function(t){"selected"==t.from?(cc.log("player drawattack"),c.setAttackList(c.currentTile.x,c.currentTile.y),s.state=7,c.playerManager.cancleActionBox()):"walkend"==t.from&&(c.setAttackList(c.currentTile.x,c.currentTile.y),s.state=4,c.playerManager.cancleActionBox())},onWalkend:function(t){"drawattack"==t.from?(c.dedrawAttack(),c.playerManager.setActionBox(c.currentPlayer),s.state=3):"drawwalk"==t.from},onEnterState:function(t){cc.log("Turn State: "+t.to)}}});cc.Class({"extends":cc.Component,properties:{map:{"default":null,type:cc.TiledMap},hideLayer:{"default":null,type:cc.TiledLayer},layer2:{"default":null,type:cc.TiledLayer},playerManager:n,Camera:r,place:{"default":null,type:cc.Prefab},state:0,teamTurn:1,currentStep:0,playerList:[],bgm:{"default":null,type:i}},onLoad:function(){c=this,o.startMyturn(this),cc.view.enableAntiAlias(!1),this.gameInit()},gameInit:function(){this.pressable=!0,this.mapInit(),this.creatrtPlayer(),this.setMouseCintrol(),this.setInputControl()},mapInit:function(){var t=this;cc.loader.loadRes("tiled/map2.tmx",cc.TiledMapAsset,function(e,a){if(e)return void cc.error(e.message||e);t.map.tmxAsset=a,t.hideLayer=t.map.getLayer("l1"),t.layer2=t.map.getLayer("l2");var n=t.hideLayer.getLayerSize();t.mapwidth=n.width,t.mapheight=n.height,t.Camera.init()})},setMouseCintrol:function(){this.node.on("mousedown",function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_RIGHT)switch(s.state){case 1:l.cancleSelect();break;case 2:l.cancleDrawWalk();break;case 3:l.cancleWalkEnd();break;case 4:l.cancleDrawAttack2();break;case 7:l.cancleDrawAttack1()}})},playerListener:function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT){if(this!==c.currentPlayer&&0!=s.state)return;if(this===c.currentPlayer&&0!=s.state)return;if(this.team!=s.teamTurn)return;var e=c.getTilePos(this.x,this.y);switch(s.state){case 0:c.currentPlayer=this,l.firstSelect();break;case 3:c.setAttackList(e.x,e.y),s.state=4}}},actionListListener:function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT)if(c.currentTile=c.getTilePos(c.currentPlayer.x,c.currentPlayer.y),"a1"==t.target.name)switch(s.state){case 1:l.drawWalk()}else if("a2"==t.target.name)switch(s.state){case 1:l.drawAttack1();break;case 3:l.drawAttack2()}},creatrtPlayer:function(){var t=this.playerManager.createrPlayer(this);this.playerManager.setSuit(t,"hairdo_1","head_1","body_3","arma_3","armb_3","armc_3","armd_3","lega_3","legb_3","legc_3","legd_3","sward_2","rpad"),this.playerManager.startAnimation(t,"stand"),this.playerManager.setTeam(t,1),this.player1=t,t.at=10,t.hp=100,t.atl=[1,2],t.walk=2,t.on("mousedown",this.playerListener);var e=this.playerManager.createrPlayer(this,64,0);this.playerManager.setSuit(e,"hairdo_2","head_1","body_3","arma_3","armb_3","armc_3","armd_3","lega_3","legb_3","legc_3","legd_3","null","rpad"),this.playerManager.setChildSlot(e,"bow","bow_1"),this.playerManager.startAnimation(e,"stand"),this.playerManager.setTeam(e,2),e.at=10,e.hp=100,e.atl=[1,2],e.walk=2,e.on("mousedown",this.playerListener);var a=this.playerManager.createrPlayer(this,64,64);this.playerManager.setSuit(a,"hairdo_2","head_1","body_2","arma_2","armb_1","armc_2","armd_1","lega_1","legb_2","legc_1","legd_2","sward_2","bpad"),this.playerManager.startAnimation(a,"stand"),this.playerManager.setTeam(a,3),a.at=10,a.hp=100,a.atl=[1,2],a.walk=2},setMoveList:function(t,e){var a=this.currentPlayer.walk;this.placeList=[];for(var n=[],r=0;r<this.mapwidth;r++){n[r]=[];for(var i=0;i<this.mapheight;i++)n[r][i]=-1}this.movelist=n,this.movelist[t][e]=0;for(var c=0;c<=a-1;c++)for(var i=this.redressY(e-a);i<=this.redressY(e+a);i++)for(var s=this.redressX(t-(a-Math.abs(e-i)));s<=this.redressX(t+(a-Math.abs(e-i)));s++)this.getMoveCount(s-1,i)!=c&&this.getMoveCount(s,i-1)!=c&&this.getMoveCount(s+1,i)!=c&&this.getMoveCount(s,i+1)!=c||this.checkPlayer(s,i)||this.setMoveCount(s,i,c);this.draw()},setAttackList:function(t,e){this.attackPlaceList=[];for(var a=[],n=0;n<this.mapwidth;n++){a[n]=[];for(var r=0;r<this.mapheight;r++)a[n][r]=-1}var i=[1,2];this.attackList=a;for(var n=0;n<i.length;n++)for(var c=this.redressX(t-i[n]);c<=this.redressX(t+i[n]);c++)for(var r=this.redressY(e-i[n]);r<=this.redressY(e+i[n]);r++)Math.abs(c-t)+Math.abs(r-e)==i[n]&&(this.attackList[c][r]=0);this.drawAttack()},redressX:function(t){var e=t;return e<0&&(e=0),e>this.mapwidth-1&&(e=this.mapwidth-1),e},redressY:function(t){var e=t;return e<0&&(e=0),e>this.mapheight-1&&(e=this.mapheight-1),e},getMoveCount:function(t,e){return t<0||t>this.mapwidth-1||e<0||e>this.mapheight-1?-1:this.movelist[t][e]},setMoveCount:function(t,e,a){var n=this.getMapCost(t,e);n<0||(a+=n,a>this.currentPlayer.walk||(this.movelist[t][e]==-1||a<this.movelist[t][e])&&(this.movelist[t][e]=a))},getMapCost:function(t,e){var a=this.map.getPropertiesForGID(this.layer2.getTileGIDAt(t,e));return a?parseInt(a.type):1},drawAttack:function(){for(var t=this,e=0;e<=this.mapheight-1;e++)for(var a=0;a<=this.mapwidth-1;a++)if(0==this.attackList[a][e]){var n=this.checkEnemy(a,e);if(n){var r=cc.instantiate(this.place);this.attackPlaceList.push(r),this.node.addChild(r,1e4);var i=this.hideLayer.getPositionAt(a,e);r.setPosition(i),r.on("mousedown",function(e){e.getButton()==cc.Event.EventMouse.BUTTON_LEFT&&t.doAttack(t.currentPlayer,t.checkEnemy(t.getTilePos(this.x,this.y).x,t.getTilePos(this.x,this.y).y))})}else{var r=cc.instantiate(this.place);r.setColor(cc.color(55,79,70)),this.attackPlaceList.push(r),this.node.addChild(r,1e4);var i=this.hideLayer.getPositionAt(a,e);r.setPosition(i)}}},dedrawAttack:function(){for(var t=0;t<this.attackPlaceList.length;t++)this.node.removeChild(this.attackPlaceList[t],!0);this.attackPlaceList=[]},checkEnemy:function(t,e){for(var a=0;a<this.playerList.length;a++)if(a!=this.teamTurn-1)for(var n=0;n<this.playerList[a].length;n++){var r=this.getTilePos(this.playerList[a][n].x,this.playerList[a][n].y);if(r.x==t&&r.y==e)return this.playerList[a][n]}return!1},checkEnemyByPosition:function(t,e){var a=this.getTilePos(t,e);return this.checkEnemy(a.x,a.y)},checkPlayer:function(t,e){for(var a=0;a<this.playerList.length;a++)for(var n=0;n<this.playerList[a].length;n++){var r=this.getTilePos(this.playerList[a][n].x,this.playerList[a][n].y);if(r.x==t&&r.y==e)return this.playerList[a][n]}return!1},doAttack:function(t,e){var a=this,n=this.checkAttack(t,e);n&&(this.playerManager.startFadeIn(t,"swardattack"),setTimeout(function(){a.playerManager.startFadeIn(t,"stand")},1e3),this.playerManager.startFadeIn(e,"swardattack2"),setTimeout(function(){a.playerManager.startFadeIn(e,"stand")},1e3)),t.actionOver=!0,l.canclePlayer(),this.dedrawAttack(),this.currentStep++},checkAttack:function(t,e){for(var a=this.getTilePos(t.x,t.y),n=this.getTilePos(e.x,e.y),r=Math.abs(a.x-n.x)+Math.abs(a.y-n.y),i=0;i<e.atl.length;i++)if(e.atl[i]==r)return!0;return!1},actionList:function(){var t=new cc.Sprite;t.spriteFrame.setTexture(cc.url.raw("resouse/text/box.png")),this.node.addChild(t,1e4),t.setPosition(100,100)},draw:function(){for(var t=0;t<=this.mapheight-1;t++)for(var e=0;e<=this.mapwidth-1;e++)if(this.movelist[e][t]>-1){var a=cc.instantiate(this.place);this.placeList.push(a),this.node.addChild(a,1e4);var n=this.hideLayer.getPositionAt(e,t);a.setPosition(n),a.on("mousedown",function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT)switch(s.state){case 2:l.walk(),c.originXY=c.currentPlayer.getPosition(),c.dedraw(),c.playerManager.startAnimation(c.currentPlayer,"walk");var e=this.x-c.currentPlayer.x>=0;c.currentPlayer.getChildByName("play_ske").runAction(cc.flipX(!e)),c.currentPlayer.runAction(cc.sequence(cc.moveTo(1,this.x,this.y),cc.callFunc(function(){c.playerManager.startAnimation(c.currentPlayer,"stand"),s.state=3,c.playerManager.setActionBox(c.currentPlayer),c.playerZindexSet()})))}})}},dedraw:function(){for(var t=0;t<this.placeList.length;t++)this.node.removeChild(this.placeList[t],!0);this.placeList=[]},playerZindexSet:function(){for(var t=0;t<this.playerList.length;t++)for(var e=0;e<this.playerList[t].length;e++)this.playerList[t][e].zIndex=this.node.getContentSize().height-this.playerList[t][e].y},shak:function(t){t.runAction(cc.sequence(cc.moveBy(.1,-10,-10),cc.moveBy(.1,10,10)))},setInputControl:function(){var t=this;cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(e,a){var n,r=t.player1;switch(e){case cc.KEY.up:t.pressable&&(t.pressable=!1,t.node.runAction(cc.sequence(cc.moveBy(.5,0,-32),cc.callFunc(function(){t.pressable=!0}))));break;case cc.KEY.down:t.pressable&&(t.pressable=!1,t.node.runAction(cc.sequence(cc.moveBy(.5,0,32),cc.callFunc(function(){t.pressable=!0}))));break;case cc.KEY.left:t.pressable&&(t.pressable=!1,t.node.runAction(cc.sequence(cc.moveBy(.5,32,0),cc.callFunc(function(){t.pressable=!0}))));break;case cc.KEY.right:t.pressable&&(t.pressable=!1,t.node.runAction(cc.sequence(cc.moveBy(.5,-32,0),cc.callFunc(function(){t.pressable=!0}))));break;case cc.KEY.w:n=cc.moveBy(.5,0,32),t.playerManager.startAnimation(r,"walk");break;case cc.KEY.s:n=cc.moveBy(.5,0,-32),t.playerManager.startAnimation(r,"walk");break;case cc.KEY.a:n=cc.moveBy(.5,-32,0),t.playerManager.startAnimation(r,"walk");break;case cc.KEY.d:n=cc.moveBy(.5,32,0),t.playerManager.startAnimation(r,"walk");break;case cc.KEY.space:n=cc.moveBy(1.6,0,0),t.playerManager.startAnimation(r,"swardattack2");break;default:return}r.runAction(cc.sequence(n,cc.callFunc(function(){t.playerManager.startAnimation(r,"stand")})))},onKeyReleased:function(t,e){}},t.node)},getTilePos:function(t,e){var a=this.node.getContentSize(),n=this.map.getTileSize(),r=Math.floor((t+1)/n.width),i=Math.floor((a.height-(e+1))/n.height);return cc.p(r,i)}}),cc._RFpop()},{AudioManager:"AudioManager",Camera:"Camera",PlayerManager:"PlayerManager"}],lunch:[function(t,e,a){"use strict";cc._RFpush(e,"042d4EejzxLaq6Uo6dSLjTR","lunch");var n=(t("SceneManager"),t("AudioManager"));cc.Class({"extends":cc.Component,properties:{startButton:{"default":null,type:cc.Node},bgm:{"default":null,type:n}},onLoad:function(){this.bgm.playBGM();var t=this;this.startButton.on("mousedown",function(e){e.getButton()==cc.Event.EventMouse.BUTTON_LEFT&&(t.bgm.stopBGM(),t.bgm.playEFT(1),cc.director.loadScene("scan2"))}),cc.sys.isMobile&&this.startButton.on(cc.Node.EventType.TOUCH_START,function(e){t.bgm.stopBGM(),t.bgm.playEFT(1),cc.director.loadScene("scan2")})}}),cc._RFpop()},{AudioManager:"AudioManager",SceneManager:"SceneManager"}]},{},["AudioManager","Camera","PlayerManager","SceneManager","game2","lunch"]);